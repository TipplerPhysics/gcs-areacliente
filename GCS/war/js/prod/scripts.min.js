/*! BBVA-global-customer-solutions - v0.0.1 - 2014-07-21 */function generateRow(data,id,permiso){var nombre=(data.split("&"),$("#nombre").val()),ap1=$("#ap1").val(),ap2=$("#ap2").val(),email=$("#email").val();dto=$("#dto").val();var html="<tr id=row"+id+"><td><span>"+nombre+"</span></td><td><span>"+ap1+"</span></td><td><span>"+ap2+"</span></td><td><span>"+email+"</span></td><td><span>"+permiso+"</span></td><td><img class='vs' src='../img/vs.png'><a class='papelera' name="+id+" data-toggle='modal' data-target='#confirm-delete'> </a><a class='lapiz' name="+id+"></a></td></tr>";return html}function updateRow(id){for(var celdas=$("#row"+id).children(),a=0;celdas.length-3>=a;a++){var $celda=$(celdas[a]),span=$celda.children().val();$celda.children().remove(),$celda.prepend("<span>"+span+"</span>")}var $celda=$(celdas[4]),span=$celda.children().find(":selected").text();$celda.children().remove(),$celda.prepend("<span>"+span+"</span>"),$("#lapiz"+id).removeClass("inactive"),$("#papelera"+id).removeClass("inactive")}function undoRow(id,arr){$("#papelera"+id).attr("data-toggle"),$("#row"+id).removeClass("editing"),$(".extended-row").remove();for(var celdas=$("#row"+id).children(),a=0;celdas.length-2>=a;a++){{var $celda=$(celdas[a]);$celda.children().val()}$celda.children().remove(),$celda.prepend("<span>"+arr[a]+"</span>")}$("#lapiz"+id).removeClass("inactive"),$("#papelera"+id).removeClass("inactive")}function undoEditRow(id){$("#papelera"+id).attr("data-toggle","modal"),$("#row"+id).removeClass("editing"),$(".extended-row").remove(),updateRow(id)}function generateChecks(pagina){$.get("../html/"+pagina,null,function(result){$(".extended-div").html(result)},"html")}function editRow(id){$("#papelera"+id).removeAttr("data-toggle"),$("#row"+id).addClass("editing"),$("#row"+id).attr("name",id),areas=$("#row"+id).attr("data-area"),-1!=areas.indexOf("Global Customer Service")&&(areas=areas.replace("Global Customer Service","gcs")),-1!=areas.indexOf("Global Product")&&(areas=areas.replace("Global Product","globalproduct")),areas=areas.split("-"),dto=$("#row"+id).attr("data-dto"),$("#row"+id).after("<tr class='extended-row' style='display: table-row;'><td><div class='extended-div'></div></td><td></td><td></td><td></td><td></td><td></td></tr>"),generateChecks("extended-user.html","extended-div");var celdas=$("#row"+id).children();cnombre=$(celdas[0]).children().html(),cap1=$(celdas[1]).children().html(),cap2=$(celdas[2]).children().html(),cemail=$(celdas[3]).children().html(),cpermiso=$("#row"+id).attr("data-permiso");for(var a=0;celdas.length-2>=a;a++){var $celda=$(celdas[a]),span=$celda.children().html();$celda.children().remove(),-1!=span.indexOf("&amp;")&&(span=span.replace("&amp;","&")),$celda.prepend("<input type='text' class='edit_input col"+id+"' value='"+span+"'>")}var $celda=$(celdas[3]),span=$celda.children().html();$celda.children().remove(),$celda.prepend("<select name='dto_ext' id='dto_ed' class='long selectpicker'><option value='Negocio - Global Customer Service (Incluye HDR)'>Negocio - Global Customer Service (Incluye HDR)</option><option value='Negocio - Global Product'>Negocio - Global Product</option><option value='Negocio - Global Sales'>Negocio - Global Sales</option><option value='IT C&IB - CTO - Soluciones T&eacute;cnicas'>IT C&IB - CTO - Soluciones T&eacute;cnicas</option><option value='IT C&IB - CTO - Arquitectura Funcional'>IT C&IB - CTO - Arquitectura Funcional</option><option value='IT C&IB - CTO - Operaciones y Soporte (Sop Swift, CAU)'>IT C&IB - CTO - Operaciones y Soporte (Sop Swift, CAU)</option><option value='IT C&IB - Control y Gesti&oacute;n'>IT C&IB - Control y Gesti&oacute;n</option><option value='IT C&IB - E- commerce C&IB'>IT C&IB - E- commerce C&IB</option><option value='IT C&IB - GCC Lending GTB & CFO'>IT C&IB - GCC Lending GTB & CFO</option><option value='IT C&IB - GTB - Global Customer Solutions'>IT C&IB - GTB - Global Customer Solutions</option><option value='IT C&IB – Global Transactional Product'>IT C&IB - Global Transactional Product</option><option value='IT C&IB – B2B Global Support'>IT C&IB - B2B Global Support</option></select>");var $celda=$(celdas[4]),span=$celda.children().val();$celda.children().remove(),$celda.prepend("<select name='permiso' id='permiso_ed' class='permiso_ed long selectpicker'>	<option value='5'>Gestor IT</option>	<option value='4'>Gestor Demanda</option>	<option value='3'>User Admin</option>	<option value='2'>App Admin</option>	<option value='1'>Super</option>	</select>"),$("#lapiz"+id).addClass("inactive"),$("#papelera"+id).addClass("inactive"),$(".selectpicker").selectpicker();var lng=areas.length;1==lng&&""==areas[0]&&(lng=0),setTimeout(function(){if($("#dto_ed").attr("data-selected-text-format",dto),$("#permiso_ed option:selected").val(cpermiso),lng>0)for(var n=0;lng>n;n++){var name=areas[n];$("#e-"+name)[0].setAttribute("checked","checked")}},750)}function resetUserForm(){$("#nombre").val(""),$("#ap1").val(""),$("#ap2").val(""),$("#email").val("")}var url=document.URL;url=1!=url.indexOf("localhost")?"http://localhost:8888":"http://gcs-areacliente.appspot.com",$(function(){$("#sidebar").hover(function(){$(this).addClass("hovering")},function(){$(this).removeClass("hovering")})});var cnombre="",cap1="",cap2="",cemail="",cpermiso="",areas,dto;$.fn.pageMe=function(opts){function previous(){var goToPage=parseInt(pager.data("curr"))-1;goTo(goToPage)}function next(){goToPage=parseInt(pager.data("curr"))+1,goTo(goToPage)}function goTo(page){var startAt=page*perPage,endOn=startAt+perPage;children.css("display","none").slice(startAt,endOn).show(),page>=1?pager.find(".prev_link").show():pager.find(".prev_link").hide(),numPages-1>page?pager.find(".next_link").show():pager.find(".next_link").hide(),pager.data("curr",page),settings.numbersPerPage>1&&($(".page_link").hide(),$(".page_link").slice(page,settings.numbersPerPage+page).show()),pager.children().removeClass("active"),pager.children().eq(page+1).addClass("active")}var $this=this,defaults={perPage:7,showPrevNext:!1,numbersPerPage:5,hidePageNumbers:!1},settings=$.extend(defaults,opts),listElement=$this,perPage=settings.perPage,children=listElement.children(),pager=$(".pagination");"undefined"!=typeof settings.childSelector&&(children=listElement.find(settings.childSelector)),"undefined"!=typeof settings.pagerSelector&&(pager=$(settings.pagerSelector));var numItems=children.size(),numPages=Math.ceil(numItems/perPage);pager.data("curr",0),settings.showPrevNext&&$('<li><a href="#" class="prev_link">«</a></li>').appendTo(pager);for(var curr=0;numPages>curr&&0==settings.hidePageNumbers;)$('<li><a href="#" class="page_link">'+(curr+1)+"</a></li>").appendTo(pager),curr++;settings.numbersPerPage>1&&($(".page_link").hide(),$(".page_link").slice(pager.data("curr"),settings.numbersPerPage).show()),settings.showPrevNext&&$('<li><a href="#" class="next_link">></a></li>').appendTo(pager),pager.find(".page_link:first").addClass("active"),pager.find(".prev_link").hide(),1>=numPages&&pager.find(".next_link").hide(),pager.children().eq(1).addClass("active"),children.hide(),children.slice(0,perPage).show(),pager.find("li .page_link").click(function(){var clickedPage=$(this).html().valueOf()-1;return goTo(clickedPage,perPage),!1}),pager.find("li .prev_link").click(function(){return previous(),!1}),pager.find("li .next_link").click(function(){return next(),!1})},$(document).ready(function(){$("#myTable").pageMe({pagerSelector:"#myPager",showPrevNext:!0,hidePageNumbers:!1,perPage:4})}),$(function(){$(".selectpicker").selectpicker()}),$(function(){var userBoxSize=0;$("#newUserButton").click(function(){$("#newUserButton").hasClass("white-btn")?($("#newUserButton").removeClass("white-btn"),$(".user_span").removeClass("blue"),userBoxSize=$(".new-user-form-holder.open").outerHeight(),$(".new-user-form-holder.open").css("height",userBoxSize),setTimeout(function(){$(".new-user-form-holder.open").removeClass("open").css("height","0px")},25)):($("#newUserButton").addClass("white-btn"),$(".user_span").addClass("blue"),$(".new-user-form-holder").addClass("open"),userBoxSize>0&&setTimeout(function(){$(".new-user-form-holder").css("height",userBoxSize)},25),setTimeout(function(){$(".new-user-form-holder.open").css("height","auto")},1e3))}),$("#confirm-delete").on("show.bs.modal",function(e){$(this).find(".danger").attr("href",$(e.relatedTarget).data("href"))}),$(".papelera").on("click",function(){$("#deleteUser").attr("name",$(this).attr("name"))}),$("#deleteUser").on("click",function(){var id=$(this).attr("name"),formURL=url+"/usersServlet?",postData="accion=delete&id="+id;$.ajax({url:formURL,type:"POST",data:postData,success:function(){$("#row"+id).fadeOut("slow"),$("#confirm-delete").modal("hide")}})}),$(".lapiz").on("click",function(){var id=$(this).attr("name");if(void 0==$(".editing")[0]||$(this).hasClass("inactive"))$(this).hasClass("inactive")||editRow(id);else{var rowid=$(".editing").attr("id").split("w")[1];undoEditRow(rowid),editRow(id)}}),$(".table_results").on("click",".cancelar-ext",function(){var id=$(".editing").attr("name"),arr=[cnombre,cap1,cap2,cemail,cpermiso];$("#papelera"+id).attr("data-toggle","modal"),undoRow(id,arr)}),$("#myTable").on("click",".guardar-ext",function(){var id=$(".editing").attr("name"),campo=$(".col"+id),areas=$(".dtos").find("input"),$fila=$("#row"+id),nombre=$(campo[0]).val(),ap1=$(campo[1]).val(),ap2=$(campo[2]).val(),email=$(campo[3]).val(),permiso=$("#permiso_ed").val(),dto=$("#dtos_select option:selected").text();dto=dto.replace("&","#");for(var areascont=$(".dtos").children(),areas="",i=0;i<areascont.length;i++){var $item=$($(areascont[i]).children()[0]);1==$item[0].checked&&(areas+=$item.val()+"-")}areas.length>1?$fila.attr("data-area",areas.substring(0,areas.length-1)):$fila.attr("data-area",""),$fila.attr("data-dto",dto);var postData="&nombre="+nombre+"&id="+id+"&dto="+dto+"&permiso="+permiso+"&email="+email+"&ap1="+ap1+"&ap2="+ap2+"&accion=update&areas="+areas,formURL="/usersServlet";$.ajax({url:formURL,type:"POST",data:postData,success:function(data){"true"==data.success&&($(".extended-row").remove(),$("#row"+id).removeClass("editing"),updateRow(id))}}),$("#papelera"+id).attr("data-toggle","modal")}),$("#submit_user_form").on("click",function(e){e.preventDefault();var $form=$("#new-user-form");if($form.valid()){var areas="";1==$("#onboarding").prop("checked")&&(areas+="Onboarding-"),1==$("#servicing").prop("checked")&&(areas+="Servicing-"),1==$("#itcib").prop("checked")&&(areas+="ITCIB-"),1==$("#gcs").prop("checked")&&(areas+="Global Customer Service-"),1==$("#global-product").prop("checked")&&(areas+="Global product-"),1==$("#clientes").prop("checked")&&(areas+="Clientes-");var postData=($("#servicing").val(),$form.serialize()+"&accion=new&areas="+areas),formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){if("true"==data.success){var html=generateRow(postData,data.id,data.permiso);$(".table_results").prepend(html),$("#message_div").removeClass("error").addClass("success"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message").html("El usuario ha sido creado de forma correcta."),$("#message_div").css("display","block"),resetUserForm(),setTimeout(function(){$("#user_form")[0].reset(),$("#message_div").fadeOut("slow",function(){$("#span_message").html("")})},5e3)}else $("#message_div").removeClass("success").addClass("error"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message").html(data.error),$("#message_div").css("display","block")},error:function(jqXHR,textStatus,errorThrown){errorThrown.length>0&&($("#span_message").html(errorThrown),$("#message_div").addClass("error").removeClass("success"))}})}return!1})}),$(function(){$.extend($.validator.messages,{required:"Este campo es obligatorio.",remote:"Por favor, rellena este campo.",email:"Por favor, escribe una direcci&oacuten de correo v&aacutelida.",url:"Por favor, escribe una URL válida.",date:"Por favor, escribe una fecha válida.",dateISO:"Por favor, escribe una fecha (ISO) válida.",number:"Por favor, escribe un n&uacutemero v&aacutelido.",digits:"Por favor, escribe s&oacutelo dígitos.",creditcard:"Por favor, escribe un número de tarjeta válido.",equalTo:"Por favor, escribe el mismo valor de nuevo.",extension:"Por favor, escribe un valor con una extensión aceptada.",maxlength:$.validator.format("Por favor, no escribas más de {0} caracteres."),minlength:$.validator.format("Por favor, no escribas menos de {0} caracteres."),rangelength:$.validator.format("Por favor, escribe un valor entre {0} y {1} caracteres."),range:$.validator.format("Por favor, escribe un valor entre {0} y {1}."),max:$.validator.format("Por favor, escribe un valor menor o igual a {0}."),min:$.validator.format("Por favor, escribe un valor mayor o igual a {0}."),nifES:"Por favor, escribe un NIF válido.",nieES:"Por favor, escribe un NIE válido.",cifES:"Por favor, escribe un CIF válido."}),$.validator.addMethod("selected",function(value,element){var valid=!1;if("default"!=value)valid=!0;else{var select=$(element).parent(),bootstrapSel=$(select).find("button.selecpicker");bootstrapSel.addClass("error")}return valid},"Por favor, selecciona un valor."),$.validator.addMethod("require-one",function(value,element){var valid=!1,selector="input[name="+$(element).attr("name")+"]";return $(element).closest("form").find(selector).each(function(){$(this).is(":checked")&&(valid=!0)}),valid},"Por favor, selecciona una opci&oacute;n."),$("form").validate({submitHandler:function(form){form.submit()},errorPlacement:function(error,$element){if(($element.is(":checkbox")||$element.is(":radio"))&&$element.parent().hasClass("radio-container")){var $target=$element.closest(".radio-container-holder"),$container=$target.find("#error-messages");0==$container.length&&($container=$('<div id="error-messages" class="block-error server-errors"><ul></ul></div>'),$element.closest(".radio-container-holder").prepend($container));var $errorelement=$("<li>");$errorelement.append(error),$container.find("ul").append($errorelement)}else{var $target=$element.closest(".form-container"),$container=$target.find("#error-messages");0==$container.length&&($container=$('<div id="error-messages" class="block-error server-errors detail"><ul></ul></div>'),$target.prepend($container));var $errorelement=$("<li>");$errorelement.append(error),$container.find("ul").append($errorelement)}}})});