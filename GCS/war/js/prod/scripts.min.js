/*! BBVA-global-customer-solutions - v0.0.1 - 2014-10-08 */function drawChecks(str){str=str.toLowerCase(),-1!=str.indexOf("argentina")?($("#argentina_check_modal").attr("checked","checked"),$("#argentina_check_modal").next().addClass("checked")):($("#argentina_check_modal").removeClass("checked"),$("#argentina_check_modal").next().removeClass("checked")),-1!=str.indexOf("belgica")?($("#belgica_check_modal").attr("checked","checked"),$("#belgica_check_modal").next().addClass("checked")):($("#belgica_check_modal").removeClass("checked"),$("#belgica_check_modal").next().removeClass("checked")),-1!=str.indexOf("chile")?($("#chile_check_modal").attr("checked","checked"),$("#chile_check_modal").next().addClass("checked")):($("#chile_check_modal").removeClass("checked"),$("#chile_check_modal").next().removeClass("checked")),-1!=str.indexOf("colombia")?($("#colombia_check_modal").attr("checked","checked"),$("#colombia_check_modal").next().addClass("checked")):($("#colombia_check_modal").removeClass("checked"),$("#colombia_check_modal").next().removeClass("checked")),-1!=str.indexOf("espa")?($("#esp_check_modal").attr("checked","checked"),$("#esp_check_modal").next().addClass("checked")):($("#esp_check_modal").removeClass("checked"),$("#esp_check_modal").next().removeClass("checked")),-1!=str.indexOf("francia")?($("#francia_check_modal").attr("checked","checked"),$("#francia_check_modal").next().addClass("checked")):($("#francia_check_modal").removeClass("checked"),$("#francia_check_modal").next().removeClass("checked")),-1!=str.indexOf("italia")?($("#italia_check_modal").attr("checked","checked"),$("#italia_check_modal").next().addClass("checked")):($("#italia_check_modal").removeClass("checked"),$("#italia_check_modal").next().removeClass("checked")),-1!=str.indexOf("mexico")?($("#mexico_check_modal").attr("checked","checked"),$("#mexico_check_modal").next().addClass("checked")):($("#mexico_check_modal").removeClass("checked"),$("#mexico_check_modal").next().removeClass("checked")),-1!=str.indexOf("peru")?($("#peru_check_modal").attr("checked","checked"),$("#peru_check_modal").next().addClass("checked")):($("#peru_check_modal").removeClass("checked"),$("#peru_check_modal").next().removeClass("checked")),-1!=str.indexOf("portugal")?($("#portugal_check_modal").attr("checked","checked"),$("#portugal_check_modal").next().addClass("checked")):($("#portugal_check_modal").removeClass("checked"),$("#portugal_check_modal").next().removeClass("checked")),-1!=str.indexOf("reino")?($("#uk_check_modal").attr("checked","checked"),$("#uk_check_modal").next().addClass("checked")):($("#uk_check_modal").removeClass("checked"),$("#uk_check_modal").next().removeClass("checked")),-1!=str.indexOf("uruguay")?($("#uruguay_check_modal").attr("checked","checked"),$("#uruguay_check_modal").next().addClass("checked")):($("#uruguay_check_modal").removeClass("checked"),$("#uruguay_check_modal").next().removeClass("checked")),-1!=str.indexOf("usa")?($("#usa_check_modal").attr("checked","checked"),$("#usa_check_modal").next().addClass("checked")):($("#usa_check_modal").removeClass("checked"),$("#usa_check_modal").next().removeClass("checked")),-1!=str.indexOf("venezuela")?($("#venezuela_check_modal").attr("checked","checked"),$("#venezuela_check_modal").next().addClass("checked")):($("#venezuela_check_modal").removeClass("checked"),$("#venezuela_check_modal").next().removeClass("checked")),-1!=str.indexOf("redex")?($("#redex_check_modal").attr("checked","checked"),$("#redex_check_modal").next().addClass("checked")):($("#redex_check_modal").removeClass("checked"),$("#redex_check_modal").next().removeClass("checked"))}function editRowCliente(id){var line=$("#row"+id),ref_local=line.data("ref-local"),logo_url=line.data("logo-url"),ref_global=line.data("ref-global"),crit=line.data("criticidad"),tipo=line.data("tipo"),nombre=line.data("nombre"),fecha_alta=line.data("fecha-alta"),paises=line.data("paises");0!=paises.length&&(paises=paises.replace("[",""),paises=paises.replace("]",""),paises=paises.replace(/, /g,"-"),drawChecks(paises)),$("#fecha_alta_cliente_modal").val(fecha_alta),$("#client_name_modal").val(nombre),$("#ref_global_modal").val(ref_global),$("#ref_local_modal").val(ref_local),$("#logo_url_modal").val(logo_url),$("#tipo_modal").val(tipo),$("#criticidad_modal").val(crit),$("#edit_client_form_modal").data("id",id),showModal()}function sendEditClient(){var $form=$("#edit-client-form");if($form.valid()){var postData=$form.serialize()+"&accion=edit&id="+id,formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success?($("#message_div_cliente_modal").removeClass("error").addClass("success"),$(".edit-user-form-holder").height()<190&&$(".edit-user-form-holder").height($(".new-user-form-holder").height()+35),$form.find(".form-container").find("div:not(#message_div)").hide(0),$("#span_message_cliente_modal").html("El cliente se ha modificado de forma correcta."),$("#message_div_cliente_modal").css("display","block"),$(".modal-footer").hide(),resetForm($form),setTimeout(function(){$("#message_div").fadeOut("slow",function(){$("#span_message").html("")}),location.reload()},5e3)):($("#message_div_cliente_modal").removeClass("success").addClass("error"),$(".edit-user-form-holder").height()<190&&$(".edit-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message_cliente_modal").html(data.error),$("#message_div_cliente_modal").css("display","block"))},error:function(){errorThrown.length>0&&($("#span_message_cliente_modal").html(errorThrown),$("#message_div_cliente_modal").addClass("error").removeClass("success"))}})}}function disableSearch(){var fila=$($("thead").children()[1]).children(),a=0;for(a=0;a<=fila.length-1;a++)$(fila[a]).children().prop("disabled",!0)}function enableSearch(){var fila=$($("thead").children()[1]).children(),a=0;for(a=0;a<=fila.length-1;a++)$(fila[a]).children().prop("disabled",!1)}function getNum_control(){var name=$("#equipo").val();if("default"!=id){var postData="accion=getNumControl&equipo="+name,formURL="/teamServlet";$.ajax({url:formURL,type:"POST",data:postData,success:function(data){if(data.success="true"){var fecha=new Date,anio=fecha.getFullYear(),codigo=name.substring(0,3).toUpperCase()+"_"+anio+data.contador;$("#numero_control").val(codigo)}}})}}function sendNewCoste(){var $form=$("#new-coste-form");if($form.valid()){var postData=$form.serialize()+"&accion=new",formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){if("true"==data.success){var coste_anal=isNaN(parseInt($("#analisis_coste").val()))?0:parseInt($("#analisis_coste").val()),coste_disenio=isNaN(parseInt($("#disenio_coste").val()))?0:parseInt($("#disenio_coste").val()),coste_constuccion=isNaN(parseInt($("#construccion_coste").val()))?0:parseInt($("#construccion_coste").val()),coste_pruebas=isNaN(parseInt($("#pruebas_coste").val()))?0:parseInt($("#pruebas_coste").val()),coste_gestion=isNaN(parseInt($("#gestion_coste").val()))?0:parseInt($("#gestion_coste").val());$("#coste").val(coste_anal+coste_disenio+coste_constuccion+coste_pruebas+coste_gestion),$form.hide(),$("#span_message_modal").html("El coste ha sido registrado de forma correcta.<br/>En breve volvemos a la p&aacute;gina."),$(".modal-footer").hide(),$("#message_div_modal").css("display","block").removeClass("error").addClass("success"),resetForm($form),$("#new-costo").modal("hide")}else $("#message_div").removeClass("success").addClass("error"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message").html(data.error),$("#message_div").css("display","block")},error:function(jqXHR,textStatus,errorThrown){errorThrown.length>0&&($("#span_message").html(errorThrown),$("#message_div").addClass("error").removeClass("success"))}})}return!1}function sendEditCoste(){var $form=$("#edit-coste-form"),formURL=$form.attr("action"),$formData=$form.serialize(),postData=$formData+"&accion=update&id="+id;$form.valid()&&$.ajax({url:formURL,type:"GET",data:postData,success:function(data){(data.success="true")?($form.hide(),$("#span_message_modal").html("El coste ha sido registrado de forma correcta.<br/>En breve volvemos a la p&aacute;gina."),$(".modal-footer").hide(),$("#message_div_modal").css("display","block").removeClass("error").addClass("success"),setTimeout(function(){resetForm($form),location.reload()},1500)):($("#span_message_modal").html(data.error),$(".modal-footer").hide(),$("#message_div_modal").css("display","block").addClass("error"))}})}function getProjectsByClient(pagina){var id;if("modal"==pagina)var id=$("#input_cliente_modal").val();else var id=$("#input_cliente").val();if("default"!=id){var postData="accion=getProjectsByClient&id="+id,formURL="/projectServlet";$.ajax({url:formURL,type:"POST",data:postData,success:function(data){var options=$("#project");options.empty(),options.removeAttr("disabled"),options.append($("<option />").val("default").text("Seleccionar...")),$.each(data,function(){options.append($("<option />").val(this.id).text(this.name))}),options.selectpicker("refresh")}})}}function editCoste(){var $currentRow=$("#row"+id),fecha_solicitud_val=$currentRow.data("fecha-solicitud-val"),comentarios=$currentRow.data("comentarios"),num_valoracion=$currentRow.data("num-valoracion"),gestor_it=$currentRow.data("gestor-it"),fecha_alta=$currentRow.data("fecha-alta"),equipo=$currentRow.data("equipo"),num_control=$currentRow.data("num-control"),nombre_proyecto=$currentRow.data("nombre-proyecto"),nombre_cliente=$currentRow.data("nombre-cliente"),analisis_coste=$currentRow.data("analisis-coste"),analisis_horas=$currentRow.data("analisis-horas"),disenio_coste=$currentRow.data("disenio-coste"),disenio_horas=$currentRow.data("disenio-horas"),construccion_coste=$currentRow.data("construccion-coste"),construccion_horas=$currentRow.data("construccion-horas"),pruebas_coste=$currentRow.data("pruebas-coste"),pruebas_horas=$currentRow.data("pruebas-horas"),gestion_coste=$currentRow.data("gestion-coste"),gestion_horas=$currentRow.data("gestion-horas"),total_coste=$currentRow.data("total-coste"),total_horas=$currentRow.data("total-horas");$("#cliente_modal").val(nombre_cliente),$("#project_modal").val(nombre_proyecto),$("#numero_control_modal").val(num_control),$("#equipo_modal").val(equipo),$("#fecha_alta_costes_modal").val(fecha_alta),$("#gestor_it_modal").val(gestor_it),$("#comentarios_modal").val(comentarios),$("#num_valoracion_modal").val(num_valoracion),$("#fecha_solicitud_valoracion_modal").val(fecha_solicitud_val),$("#analisis_horas_modal").val(analisis_horas),$("#analisis_coste_modal").val(analisis_coste),$("#disenio_horas_modal").val(disenio_horas),$("#disenio_coste_modal").val(disenio_coste),$("#construccion_horas_modal").val(construccion_horas),$("#construccion_coste_modal").val(construccion_coste),$("#pruebas_horas_modal").val(pruebas_horas),$("#pruebas_coste_modal").val(pruebas_coste),$("#gestion_horas_modal").val(gestion_horas),$("#gestion_coste_modal").val(gestion_coste),$("#total_horas_modal").val(total_horas),$("#total_coste_modal").val(total_coste),showModal()}function showModal(){initSelectpickers(),initDatepickers(),$("#ajax_loader").css("display","none"),$(".modal_ajax").css("display","block")}function sendEditDemanda(){var $form=$("#edit-demanda-form"),formURL=$form.attr("action"),$formData=$("#edit-demanda-form").serialize(),postData=$formData+"&accion=update&id="+id;$form.valid()&&$.ajax({url:formURL,type:"GET",data:postData,success:function(){$form.hide(),$("#span_message_demanda_modal").html("La demanda ha sido modificada de forma correcta.<br/>En breve volvemos a la p&aocute;gina."),$(".modal-footer").hide(),$("#message_div_demanda_modal").css("display","block").removeClass("error").addClass("success"),setTimeout(function(){resetForm($form),location.reload()},1500)}})}function resetForm($form){$form.find("input").each(function(){"text"==$(this).attr("type")?$(this).val(""):("radio"==$(this).attr("type")||"checkbox"==$(this).attr("type"))&&($(this).prop("checked",!1),$(this).parent().find("label").removeClass("checked"))}),$form.find("textarea").each(function(){$(this).val("")});var $selects=$form.find("select"),selectTotal=$selects.length;$selects.each(function(i){$(this).find("option:eq(0)").prop("selected",!0),i===selectTotal-1&&$form.find(".selectpicker").selectpicker("refresh")});var validator=$form.validate();validator.resetForm(),$form.find(".bootstrap-select.error").removeClass("error")}function changeActionsButtonColor(){$("#accion_menu").hasClass("white")?$("#accion_menu").removeClass("white"):$("#accion_menu").addClass("white")}function edit_conectividad_form_modal(){var $form=$("#edit-conectividad-form"),formURL=$form.attr("action"),$formData=$form.serialize(),postData=$formData+"&accion=new&project_id="+id+"&conect_id=";$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success}})}function loadEditModal(){var accion=$("#select_edit_action").val(),git=$("#row"+id).data("gestor-it"),gn=$("#row"+id).data("gestor-negocio"),client=$("#row"+id).data("cliente");"proyecto"==accion?($("#edit-action").modal("hide"),$("#edit-project").modal({remote:"../projectModal.do?git="+git+"&gn="+gn+"&client="+client}),$("#edit-project").modal("show")):"coste"==accion?$("#edit-action").modal("hide"):(accion="conectividad")?($("#edit-action").modal("hide"),$("#new-conectividad").modal({remote:"../loadConectivity.do?id="+id}),$("#new-conectividad").modal("show")):(accion="servicios")&&$("#edit-action").modal("hide")}function sendEditProject(){var $form=$("#edit-project-form"),formURL=$form.attr("action"),$formData=$form.serialize(),postData=$formData+"&accion=update&id="+id;$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success?($form.hide(),$("#span_message_demanda_modal").html("El proyecto ha sido modificado de forma correcta."),$(".modal-footer").hide(),$("#message_div_demanda_modal").css("display","block").removeClass("error").addClass("success"),setTimeout(function(){resetForm($form),location.reload()},1500)):($("#span_message_demanda_modal").html(data.error),$("#message_div_demanda_modal").css("display","block").removeClass("success").addClass("error"))}})}function modalCliente(){$("#edit_project_form_modal").data("id",id);var $currentRow=$("#row"+id),fecha_alta=$currentRow.attr("data-fecha-alta"),nombre=$currentRow.attr("data-nombre"),tipo=$currentRow.attr("data-tipo"),cliente=$currentRow.attr("data-cliente"),clasificacion=$currentRow.attr("data-clasificacion"),gestor_it=$currentRow.attr("data-gestor-it"),gestor_negocio=$currentRow.attr("data-gestor-negocio"),coste=$currentRow.attr("data-coste"),producto=$currentRow.attr("data-producto"),conectividad=$currentRow.attr("data-conectividad"),servicio=$currentRow.attr("data-servicio"),fecha_ini_valoracion=$currentRow.attr("data-fecha-ini-valoracion"),fecha_fin_valoracion=$currentRow.attr("data-fecha-fin-valoracion"),fecha_ini_viabilidad=$currentRow.attr("data-fecha-ini-viabilidad"),fecha_fin_viabilidad=$currentRow.attr("data-fecha-fin-viabilidad");$("#producto_modal").val(producto),$("#conectividad_modal").val(conectividad),$("#servicio_modal").val(servicio),$("#fecha_inicio_valoracion_modal").val(fecha_ini_valoracion),$("#fecha_fin_valoracion_modal").val(fecha_fin_valoracion),$("#fecha_inicio_viabilidad_modal").val(fecha_ini_viabilidad),$("#fecha_fin_viabilidad_modal").val(fecha_fin_viabilidad),$("#fecha_alta_cliente_modal").val(fecha_alta),$("#project_name_modal").val(nombre),$("#tipo_modal").val(tipo),$("#input_cliente_modal").val(cliente),$("#clasificacion_modal").val(clasificacion),$("#gestor_it_modal").val(gestor_it),$("#gestor_negocio_modal").val(gestor_negocio),$("#coste_modal").val(coste),showModal()}function sendEditUser(){var $form=$("#edit-user-form");if($form.valid()){var areas="",$checkedBoxes=$form.find(".radio-container-holder").find(".radio-container").find("input:checked");$checkedBoxes.each(function(i){areas+=$(this).val(),i<$checkedBoxes.length-1&&(areas+="_")});var postData=$form.serialize()+"&accion=update&areasStr="+areas,formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success?($(".edit-user-form-holder").height()<190&&$(".edit-user-form-holder").height($(".edit-user-form-holder").height()+35),$form.find(".form-container").find("div:not(#message_div_modal)").hide(0),$form.find("#span_message_modal").html("El usuario ha sido modificado de forma correcta.<br/>En breve volvemos a la p&aacute;gina."),$("#modal-footer_submit").css("display","none"),$("#message_div_modal").css("display","block").removeClass("error").addClass("success"),setTimeout(function(){resetForm($form),location.reload()},1500)):($("#message_div_modal").removeClass("success").addClass("error"),$(".edit-user-form-holder").height()<190&&$(".edit-user-form-holder").height($(".edit-user-form-holder").height()+35),$("#span_message_modal").html(data.error),$("#message_div_modal").css("display","block"))}},"html")}}function generateRow(data,id,permiso,permisoid,dto,area){var nombre=(data.split("&"),$("#nombre").val()),ap1=$("#ap1").val(),ap2=$("#ap2").val(),email=$("#email").val(),html="<tr id=row"+id+" class='valid-result' data-dto='"+dto+"' data-mail='"+email+"' data-permiso='"+permisoid+"' data-area='"+area+"'><td><span>"+nombre+"</span></td><td><span>"+ap1+"</span></td><td><span>"+ap2+"</span></td><td><span>"+dto+"</span></td><td><span>"+permiso+"</span></td><td><img class='vs' src='../img/vs.png'><a class='lapiz' id='lapiz"+id+"' name="+id+"></a><a class='papelera' id='papelera"+id+"' name="+id+" data-toggle='modal' data-target='#confirm-delete'> </a></td></tr>";return html}function updateRow(id){for(var celdas=$("#row"+id).children(),a=0;celdas.length-3>=a;a++){var $celda=$(celdas[a]),span=$celda.children().val();$celda.children().remove(),$celda.prepend("<span>"+span+"</span>")}var $celda=$(celdas[4]),span=$celda.children().find(":selected").text();$celda.children().remove(),$celda.prepend("<span>"+span+"</span>"),$("#lapiz"+id).removeClass("inactive"),$("#papelera"+id).removeClass("inactive")}function undoRow(id,arr){$("#papelera"+id).attr("data-toggle"),$("#row"+id).removeClass("editing");var dto=$("#dto_ed option:selected").text(),perfil=$("#permiso_ed option:selected").text();$(".extended-row").remove();for(var celdas=$("#row"+id).children(),a=0;celdas.length-4>=a;a++){{var $celda=$(celdas[a]);$celda.children().val()}$celda.children().remove(),$celda.prepend("<span>"+arr[a]+"</span>")}$celda=$(celdas[3]),$celda.children().remove(),$celda.prepend("<span>"+dto+"</span>"),$celda=$(celdas[4]),$celda.children().remove(),$celda.prepend("<span>"+perfil+"</span>"),$("#lapiz"+id).removeClass("inactive"),$("#papelera"+id).removeClass("inactive")}function undoEditRow(id){$("#row"+id).removeClass("editing"),$(".extended-row").remove(),updateRow(id)}function generateChecks(pagina){$.get("../html/"+pagina,null,function(result){$(".extended-div").html(result)},"html")}function editRow(id){{var $currentRow=$("#row"+id),$table=$currentRow.closest("table");$table.find("#edit-item-holder")}areas=$currentRow.attr("data-area"),-1!=areas.indexOf("Global Customer Service")&&(areas=areas.replace("Global Customer Service","gcs")),-1!=areas.indexOf("Global Product")&&(areas=areas.replace("Global Product","globalproduct")),0!=areas.lenght&&(areas=areas.split("_"),drawChecksAreas(areas)),dto=$currentRow.attr("data-dto");var celdas=$currentRow.children();cnombre=$(celdas[0]).children().html(),cap1=$(celdas[1]).children().html(),cap2=$(celdas[2]).children().html(),cdepartamento=$currentRow.data("dto"),cpermiso=$currentRow.data("permiso"),email=$currentRow.attr("data-mail"),$("#id_modal").val(id),$("#nombre_modal").val(cnombre),$("#ap1_modal").val(cap1),$("#ap2_modal").val(cap2),$("#email_modal").val(email),$("#dto_select_modal").val(cdepartamento),$("#permiso_select_modal").val(cpermiso),showModal()}function drawChecksAreas(str){for(x=0;x<str.length;x++)str[x]=str[x].toLowerCase(),-1!=str[x].indexOf("onboarding")?($("#onboarding_modal").attr("checked","checked"),$("#onboarding_modal").next().addClass("checked")):($("#onboarding_modal").removeClass("checked"),$("#onboarding_modal").next().removeClass("checked")),-1!=str[x].indexOf("servicing")?($("#servicing_modal").attr("checked","checked"),$("#servicing_modal").next().addClass("checked")):($("#servicing_modal").removeClass("checked"),$("#servicing_modal").next().removeClass("checked")),-1!=str[x].indexOf("clientes")?($("#clientes_modal").attr("checked","checked"),$("#clientes_modal").next().addClass("checked")):($("#clientes_modal").removeClass("checked"),$("#clientes_modal").next().removeClass("checked")),-1!=str[x].indexOf("itcib")?($("#itcib_modal").attr("checked","checked"),$("#itcib_modal").next().addClass("checked")):($("#itcib_modal").removeClass("checked"),$("#itcib_modal").next().removeClass("checked")),-1!=str[x].indexOf("gcs")?($("#gcs_modal").attr("checked","checked"),$("#gcs_modal").next().addClass("checked")):($("#gcs_modal").removeClass("checked"),$("#gcs_modal").next().removeClass("checked")),-1!=str[x].indexOf("globalproduct")?($("#global-product_modal").attr("checked","checked"),$("#global-product_modal").next().addClass("checked")):($("#global-product_modal").removeClass("checked"),$("#global-product_modal").next().removeClass("checked"))}$(function(){function getClientData(){$("#input_cliente").val(),$("#tipo").val(),$("#criticidad").val()}$("#edit-client").on("loaded.bs.modal",function(){editRowCliente(id)}),$(".client_box").on("click",function(){var id=this.getAttribute("data-id");window.location.replace("../clientProfile.do?id="+id)}),$("#deleteCliente").on("click",function(){var id=$(this).attr("name"),formURL="/clienteServlet?",postData="accion=delete&id="+id;$.ajax({url:formURL,type:"POST",data:postData,success:function(){$("#row"+id).fadeOut("fast",function(){$(this).remove(),$("#myTable").paginateMe({pagerSelector:"#myPager",showPrevNext:!0,hidePageNumbers:!1,perPage:5})}),$("#confirm-delete").modal("hide")}})}),$("#submit_client_form_modal").on("click",function(e){e.preventDefault();{var $form=$("#new-client-form-modal");getClientData($form)}if($form.valid()){var postData=$form.serialize()+"&accion=new",formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){if("true"==data.success){var options=$("#input_cliente");options.append($("<option selected/>").val(data.id).text($("#client_name").val())),options.selectpicker("refresh"),$("#message_div_cliente").removeClass("error").addClass("success"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message_cliente").html("El cliente se ha creado de forma correcta."),$("#message_div_cliente").css("display","block"),resetForm($form),setTimeout(function(){$("#message_div_cliente").fadeOut("slow",function(){$("#span_message_cliente").html("")}),$("#new-client").modal("toggle")},5e3)}else $("#message_div_cliente").removeClass("success").addClass("error"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message_cliente").html(data.error),$("#message_div_cliente").css("display","block")},error:function(jqXHR,textStatus,errorThrown){errorThrown.length>0&&($("#span_message").html(errorThrown),$("#message_div").addClass("error").removeClass("success"))}})}}),$("#edit_client_form_modal").on("click",function(){var $form=$("#edit-client-form"),id=$(this).data("id");if($form.valid()){var postData=$form.serialize()+"&accion=edit&id="+id,formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success?($("#message_div_cliente_modal").removeClass("error").addClass("success"),$(".edit-user-form-holder").height()<190&&$(".edit-user-form-holder").height($(".new-user-form-holder").height()+35),$form.find(".form-container").find("div:not(#message_div)").hide(0),$("#span_message_cliente_modal").html("El cliente se ha creado de forma correcta."),$("#message_div_cliente_modal").css("display","block"),$(".modal-footer").css("display","none"),resetForm($form),setTimeout(function(){$("#message_div").fadeOut("slow",function(){$("#span_message").html("")}),location.reload()},5e3)):($("#message_div_cliente_modal").removeClass("success").addClass("error"),$(".edit-user-form-holder").height()<190&&$(".edit-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message_cliente_modal").html(data.error),$("#message_div_cliente_modal").css("display","block"))},error:function(){errorThrown.length>0&&($("#span_message_cliente_modal").html(errorThrown),$("#message_div_cliente_modal").addClass("error").removeClass("success"))}})}}),$("#submit_client_form").on("click",function(e){e.preventDefault();{var $form=$("#new-client-form");getClientData($form)}if($form.valid()){var postData=$form.serialize()+"&accion=new",formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success?($("#message_div_cliente").removeClass("error").addClass("success"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$form.find(".form-container").find("div:not(#message_div)").hide(0),$("#span_message_cliente").html("El cliente se ha creado de forma correcta."),$("#message_div_cliente").css("display","block"),$("#buttons_new_client").css("display","none"),resetForm($form),setTimeout(function(){$("#message_div").fadeOut("slow",function(){$("#span_message").html("")}),$("#newUserButton").click(),location.reload()},5e3)):($("#message_div_cliente").removeClass("success").addClass("error"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message_cliente").html(data.error),$("#message_div_cliente").css("display","block"))},error:function(jqXHR,textStatus,errorThrown){errorThrown.length>0&&($("#span_message").html(errorThrown),$("#message_div").addClass("error").removeClass("success"))}})}}),$(".gestion_cliente").on("click",".lapiz",function(){id=$(this).attr("name")})});var url=document.URL;url=url.indexOf("localhost")>1?"http://localhost:8888":"http://gcs-areacliente.appspot.com",$(function(){$("#edit-coste").on("loaded.bs.modal",function(){editCoste(id)}),$(".gestion_coste").on("click",".lapiz",function(){id=$(this).attr("name")}),$(".gestion_coste").on("click",".papelera",function(){$("#deleteCoste").attr("name",$(this).attr("name"))}),$("#deleteCoste").on("click",function(){var id=$(this).attr("name"),formURL="/costeServlet?",postData="accion=delete&id="+id;$.ajax({url:formURL,type:"POST",data:postData,success:function(){$("#row"+id).fadeOut("fast",function(){$(this).remove(),$("#myTable").paginateMe({pagerSelector:"#myPager",showPrevNext:!0,hidePageNumbers:!1,perPage:5})}),$("#confirm-delete").modal("hide")}})}),$("#submit_cost_form").on("click",function(e){e.preventDefault();var $form=$("#new-coste-form");if($form.valid()){var postData=$form.serialize()+"&accion=new",formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success?($("#message_div").removeClass("error").addClass("success"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message").html("El pago ha sido creado de forma correcta."),$("#message_div").css("display","block"),$("#buttons_new_demanda").css("display","none"),$(".message-container").css("display","block"),resetForm($form),$form.hide(),setTimeout(function(){$("#message_div").fadeOut("slow",function(){$("#span_message").html("")}),location.reload()},5e3)):($("#message_div").removeClass("success").addClass("error"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message").html(data.error),$("#message_div").css("display","block"))},error:function(jqXHR,textStatus,errorThrown){errorThrown.length>0&&($("#span_message").html(errorThrown),$("#message_div").addClass("error").removeClass("success"))}})}return!1})});var opciones_estado="<option value='PDTE Doc Alcance en GCS'>PDTE Doc Alcance en GCS</option><option value='P-950 en confecci&oacute;n'>P-950 en confección</option><option value='PDTE Valoración IT'>PDTE Valoración IT</option><option value='PDTE Plan de Trabajo IT'>PDTE Plan de Trabajo IT</option><option value='PDTE Visto Bueno del CL del plan de trabajo'>PDTE Visto Bueno del CL del plan de trabajo</option><option value='En Desarrollo'>En Desarrollo</option><option value='En Test - Conectividad'>En Test - Conectividad</option><option value='En Test - Integración'>En Test - Integración</option><option value='En Test - Aceptación'>En Test - Aceptación</option><option value='Parado por Negocio - Producto'>Parado por Negocio - Producto</option><option value='Parado por Negocio'>Parado por Negocio</option><option value='Parado por IT'>Parado por IT</option><option value='Excluido por Negocio'>Excluido por Negocio</option><option value='Excluido por Timeout'>Excluido por Timeout</option><option value='PDTE Implantar'>PDTE Implantar</option><option value='En Penny Test'>En Penny Test</option><option value='Implementado con OK'>Implementado con OK</option><option value='Implementado sin OK'>Implementado sin OK</option>",id;$(document).on("hidden.bs.modal",function(e){$(".modal-content").html(),$(e.target).removeData("bs.modal")}),$(function(){function getDemandaData(){var params="",motivo_catalogacion=$("#motivo_catalogacion").val(),comentarios=$("#comentarios").val();return params="&motivo_calogacion="+motivo_catalogacion+"&comentarios="+comentarios}function undoRowDemanda(id){$("#papelera"+id).attr("data-toggle"),$("#row"+id).removeClass("editing"),$(".extended-row").remove();for(var celdas=$("#row"+id).children(),a=0;celdas.length-4>=a;a++){var $celda=$(celdas[a]),span=$celda.children().val();$celda.children().remove(),$celda.prepend("<span>"+span+"</span>")}$celda=$(celdas[2]),$celda.children().remove(),$celda.prepend("<span>"+tipoini+"</span>"),$celda=$(celdas[3]),$celda.children().remove(),$celda.prepend("<span>"+estadoini+"</span>"),$("#lapiz"+id).removeClass("inactive"),$("#papelera"+id).removeClass("inactive")}function editRowDemanda(id){var $currentRow=$("#row"+id),$table=$currentRow.closest("table"),celdas=($table.find("#edit-item-holder"),$currentRow.children()),fechaEntrada=$(celdas[0]).children().html(),horaEntrada=$currentRow.data("hora-peticion"),cliente=$currentRow.data("clienteid"),tipo=$(celdas[2]).children().html(),estado=$(celdas[3]).children().html(),gestorNegocio=($(celdas[4]).children().html(),$currentRow.data("gestor-negocio")),gestorIT=$currentRow.data("gestor-it"),fechaComun=$currentRow.data("fecha-comun"),horaComun=$currentRow.data("hora-comun"),devuelta=$currentRow.data("devuelta"),catalogacion=$currentRow.data("catalogacion"),motivo=$currentRow.data("motivo"),comentarios=$currentRow.data("comentarios"),fechaSolicitud=$currentRow.data("fecha-solicitud"),horaSolicitud=$currentRow.data("hora-solicitud");$("#fecha_comunicacion_asignacion_modal").val(fechaComun),$("#hora_comunicacion_asignacion_modal").val(horaComun.split(":")[0]),$("#min_comunicacion_asignacion_modal").val(horaComun.split(":")[1]),$("#fecha_solicitud_asignacion_modal").val(fechaSolicitud),$("#hora_solicitud_asignacion_modal").val(horaSolicitud.split(":")[0]),$("#min_solicitud_asignacion_modal").val(horaSolicitud.split(":")[1]),$("#motivo_catalogacion_modal").val(motivo),$("#comentarios_modal").val(comentarios),$("#fecha_entrada_peticion_modal").val(fechaEntrada),$("#hora_peticion_modal").val(horaEntrada.split(":")[0]),$("#min_peticion_modal").val(horaEntrada.split(":")[1]),$("#input_cliente_modal").val(cliente),$("#gestor_negocio_modal").val(gestorNegocio),$("#gestor_it_modal").val(gestorIT),$("#tipo_modal").val(tipo),$("#devuelta_modal").val(1==devuelta?"SI":"NO"),$("#estado_modal").val(estado),$("#catalogacion_peticion_modal").val(catalogacion),showModal()
}var tipoini="",estadoini="";$("#edit-demanda").on("loaded.bs.modal",function(){editRowDemanda(id)}),$(".gestion_demanda").on("click",".lapiz",function(){id=$(this).attr("name")}),$(".gestion_demanda").on("click",".cancelar-ext-demanda",function(){var id=$(".editing").attr("name");$("#papelera"+id).attr("data-toggle","modal"),undoRowDemanda(id),enableSearch()}),$("#myTable").on("click",".guardar-ext-demanda",function(){var id=$(".editing").attr("name"),campo=$(".col"+id),$fila=$("#row"+id),fecha=$(campo[0]).val(),cliente=$(campo[1]).val(),tipo=$("#tipo_ed option:selected").val(),estado=$("#estado_ed option:selected").val(),gestor_it=$("#gestor_it_ext option:selected").val(),fecha_entrada=$("#fecha_entrada_peticion_ext").val(),hora_peticion_ext=$("#hora_peticion_ext option:selected").val(),min_peticion_ext=$("#min_peticion_ext option:selected").val();$fila.attr("data-gestor-asig",gestor_it),$fila.attr("data-fecha-entrada",fecha_entrada),$fila.attr("data-hora-entrada",hora_peticion_ext+":"+min_peticion_ext);var postData="fecha_entrada="+fecha+"&cliente="+cliente+"&tipo="+tipo+"&estado="+estado+"&gestor_it="+gestor_it+"&fecha_asignacion="+fecha_entrada+"&hora_peticion_ext="+hora_peticion_ext+"&accion=update&min_peticion_ext="+min_peticion_ext+"&id="+id,formURL="/demandaServlet";$.ajax({url:formURL,type:"POST",data:postData,success:function(){location.reload()}}),$("#papelera"+id).attr("data-toggle","modal")}),$(".gestion_demanda").on("click",".papelera",function(){$("#deleteDemanda").attr("name",$(this).attr("name"))}),$("#deleteDemanda").on("click",function(){var id=$(this).attr("name"),formURL="/demandaServlet?",postData="accion=delete&id="+id;$.ajax({url:formURL,type:"POST",data:postData,success:function(){$("#row"+id).fadeOut("fast",function(){$(this).remove(),$("#myTable").paginateMe({pagerSelector:"#myPager",showPrevNext:!0,hidePageNumbers:!1,perPage:5})}),$("#confirm-delete").modal("hide")}})}),$("#submit_demanda_form").on("click",function(e){e.preventDefault();var $form=$("#new-demanda-form"),params=getDemandaData($form);if($form.valid()){var postData=$form.serialize()+params+"&accion=new",formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success?($("#message_div").removeClass("error").addClass("success"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message").html("La petici&oacute;n ha sido creada de forma correcta con el c&oacute;digo de petici&oacute;n num: "+data.cod_peticion),$("#message_div").css("display","block"),$("#buttons_new_demanda").css("display","none"),$(".message-container").css("display","block"),resetForm($form),$form.hide(),setTimeout(function(){$("#message_div").fadeOut("slow",function(){$("#span_message").html("")}),location.reload()},5e3)):($("#message_div").removeClass("success").addClass("error"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message").html(data.error),$("#message_div").css("display","block"))},error:function(jqXHR,textStatus,errorThrown){errorThrown.length>0&&($("#span_message").html(errorThrown),$("#message_div").addClass("error").removeClass("success"))}})}return!1})}),$(function(){initForms()});var initForms=function(){$("form").parent().find("button.close-form").off(".close-form").on("click.close-form",function(){$(this).parent().find("form");return $("#newUserButton").trigger("click"),!1}),$("form").find(".radio-container").each(function(){var $checkbox=$(this).find('input[type="checkbox"]'),$label=$(this).find("label");$checkbox.prop("checked")&&$label.addClass("checked"),$label.off(".check-label").on("click.check-label",function(){$(this).toggleClass("checked")})})};$(function(){initDatepickers(),initSelectpickers()});var initDatepickers=function(){$("form").find(".datepicker").each(function(){var $datepicker=$(this);if($datepicker.hasClass("datefuture"))if($datepicker.val()){var minDate=new Date(getIsoDate($datepicker.val()));$datepicker.datepicker({minDate:minDate})}else $datepicker.datepicker({minDate:0});else $datepicker.hasClass("datepast")?$datepicker.datepicker({maxDate:0}):$datepicker.datepicker();if($datepicker.hasClass("fromTo")){var $targetDatepicker=$("#"+$datepicker.data("target-id"));$datepicker.on("change.fromTo",function(){$targetDatepicker.datepicker("option","minDate",$datepicker.datepicker("getDate"))})}})},initSelectpickers=function(){$("html").find(".selectpicker").selectpicker()},getIsoDate=function(dateString){var collection=dateString.split("/"),day=collection[0],month=collection[1],year=collection[2],isoDate=year+"/"+month+"/"+day;return isoDate};$(function(){function drawLetters(){var isEmpty,letra,cajas=$(".clients_container").children(),a=0,letrasValidas="";for(a;a<=cajas.length-1;a++){var div=$(cajas[a]);if(div.hasClass("letter_anchor"))isEmpty=!0,letra=div;else if(div.hasClass("clientes_letra")){var clientes=div.children(),b=0;for(b;b<=clientes.length-1;b++){var cliente=$(clientes[b]);cliente.hasClass("tipo_h")||cliente.hasClass("crit_h")||cliente.hasClass("search_h")||(isEmpty=!1)}1==isEmpty?(letra.css("display","none"),letra.prev().css("display","none"),div.css("display","none")):(letra.css("display","block"),letrasValidas+=$(letra.find("span")[0]).text(),letra.prev().css("display","inline-block"),div.css("display","inherit"))}}drawbar(letrasValidas)}function drawbar(string){var barra=$(".abc").children(),z=0;for(z=0;z<=barra.length-1;z++){var letras=$(barra[z]).children(),a=0;for(a;a<=letras.length-1;a++){var letra_div=$(letras[a]),letra=letra_div[0].id.substring(6,7);-1!=string.indexOf(letra)?(letra_div.attr("href","#"+letra+"_anchor"),letra_div.children().addClass("active"),letra_div.children().removeClass("inactive")):(letra_div.removeAttr("href"),letra_div.children().addClass("inactive"),letra_div.children().removeClass("active"))}}}$(window).scroll(function(){var scroll=$(window).scrollTop();scroll>350?($("#abc_child_scroll").addClass("inScroll"),$("#abc_child_scroll").removeClass("scroll_hidden")):($("#abc_child_scroll").removeClass("inScroll"),$("#abc_child_scroll").addClass("scroll_hidden"))}),$(".clients").on("click","#accion_menu",function(){changeActionsButtonColor()}),$("#buscador_cliente").on("keyup",function(){var busqueda=$(this).val(),ln_busqueda=busqueda.length,clientes=$(".client_box"),a=0;for(a;a<=clientes.length-1;a++)busqueda.toUpperCase()==$(clientes[a]).children().text().substring(0,ln_busqueda).toUpperCase()?$(clientes[a]).removeClass("search_h"):$(clientes[a]).addClass("search_h");drawLetters()}),$("#tip_crit").on("change",function(){var a,val=$("#tip_crit").val(),cajas=$(".client_box");if("0"==val)for(a=0;a<=cajas.length-1;a++)$(cajas[a]).removeClass("crit_h");else for(a=0;a<=cajas.length-1;a++)$(cajas[a]).hasClass("crit_"+val)?$(cajas[a]).removeClass("crit_h"):$(cajas[a]).addClass("crit_h");drawLetters()}),$("#tip_client").on("change",function(){var a,val=$("#tip_client").val(),cajas=$(".client_box");if("0"==val)for(a=0;a<=cajas.length-1;a++)$(cajas[a]).removeClass("tipo_h");else for(a=0;a<=cajas.length-1;a++)$(cajas[a]).hasClass("tipo_"+val)?$(cajas[a]).removeClass("tipo_h"):$(cajas[a]).addClass("tipo_h");drawLetters()})}),$.fn.paginateMe=function(opts){function previous(){var goToPage=parseInt(pager.data("curr"))-1;goTo(goToPage)}function next(){goToPage=parseInt(pager.data("curr"))+1,goTo(goToPage)}function goTo(page){var startAt=page*perPage,endOn=startAt+perPage;children.css("display","none").slice(startAt,endOn).show(),page>=1?pager.find(".prev_link").show():pager.find(".prev_link").hide(),numPages-1>page?pager.find(".next_link").show():pager.find(".next_link").hide(),pager.data("curr",page),settings.numbersPerPage>1&&($(".page_link").hide(),$(".page_link").slice(page,settings.numbersPerPage+page).show()),pager.children().removeClass("active"),pager.children().eq(page+1).addClass("active"),$(resumen).html("");var ocursinpage2=5*(page+1)>numItems?numItems:5*(page+1);$(resumen).html(numItems>0?numItems>=5?"Resultados "+(5*(page+1)-4)+" a "+ocursinpage2+" de "+numItems:"Resultados "+(5*(page+1)-4)+" a "+ocursinpage2+" de "+numItems:"No hay resultados")}var $this=this,defaults={perPage:5,showPrevNext:!1,numbersPerPage:5,hidePageNumbers:!1},settings=$.extend(defaults,opts),listElement=$this,perPage=settings.perPage,children=listElement.find(".valid-result"),pager=$(".pagination"),resumen=$(".pagesummary");"undefined"!=typeof settings.childSelector&&(children=listElement.find(settings.childSelector)),"undefined"!=typeof settings.pagerSelector&&(pager=$(settings.pagerSelector));var numItems=children.size(),numPages=Math.ceil(numItems/perPage);$(pager).html(""),pager.data("curr",0),settings.showPrevNext&&$('<li><a href="#" class="prev_link"><</a></li>').appendTo(pager);for(var curr=0;numPages>curr&&0==settings.hidePageNumbers;)$('<li><a href="#" class="page_link">'+(curr+1)+"</a></li>").appendTo(pager),curr++;settings.numbersPerPage>1&&($(".page_link").hide(),$(".page_link").slice(pager.data("curr"),settings.numbersPerPage).show()),settings.showPrevNext&&$('<li><a href="#" class="next_link">></a></li>').appendTo(pager),pager.find(".page_link:first").addClass("active"),pager.find(".prev_link").hide(),1>=numPages&&pager.find(".next_link").hide(),pager.children().eq(1).addClass("active"),children.hide(),children.slice(0,perPage).show();var currentPage=pager.children().eq(1).children().html(),ocursinpage=5*currentPage>numItems?numItems:5*currentPage;$(resumen).html(""),$(resumen).html(numItems>0?numItems>=5?"Resultados "+(5*currentPage-4)+" a "+ocursinpage+" de "+numItems:"Resultados "+(5*currentPage-4)+" a "+ocursinpage+" de "+numItems:"No hay resultados"),pager.find("li .page_link").click(function(){var clickedPage=$(this).html().valueOf()-1;return goTo(clickedPage,perPage),!1}),pager.find("li .prev_link").click(function(){return previous(),!1}),pager.find("li .next_link").click(function(){return next(),!1})},$(function(){$("#producto").change(function(){$("#conectividad").empty(),$("#producto").val().indexOf("H2H")>=0?($("#conectividad").append(new Option("Seleccionar","default")),$("#conectividad").append(new Option("AS2","AS2")),$("#conectividad").append(new Option("FTP","FTP")),$("#conectividad").append(new Option("FTPS","FTPS")),$("#conectividad").append(new Option("SFTP","SFTP")),$("#conectividad").append(new Option("Webservices","Webservices"))):$("#producto").val().indexOf("H2H")<0&&$("#producto").val().indexOf("default")<0?($("#conectividad").append(new Option("Seleccionar","default")),$("#conectividad").append(new Option("Score","Score")),$("#conectividad").append(new Option("Macug","Macug"))):($("#conectividad").empty(),$("#conectividad").append(new Option("Seleccionar","default"))),$("#conectividad").selectpicker("refresh")}),$("#alta_proyecto").on("click",".lapiz",function(){id=$(this).attr("name")}),$("#alta_proyecto").on("loaded.bs.modal",function(){modalCliente(id),$("#producto_modal").change(function(){alert("entraaaaaaaa"),$("#conectividad_modal").empty(),$("#producto_modal").val().indexOf("H2H")>=0?($("#conectividad_modal").append(new Option("Seleccionar","default")),$("#conectividad_modal").append(new Option("AS2","AS2")),$("#conectividad_modal").append(new Option("FTP","FTP")),$("#conectividad_modal").append(new Option("FTPS","FTPS")),$("#conectividad_modal").append(new Option("SFTP","SFTP")),$("#conectividad_modal").append(new Option("Webservices","Webservices"))):$("#producto_modal").val().indexOf("H2H")<0&&$("#producto_modal").val().indexOf("default")<0?($("#conectividad_modal").append(new Option("Seleccionar","default")),$("#conectividad_modal").append(new Option("Score","Score")),$("#conectividad_modal").append(new Option("Macug","Macug"))):($("#conectividad_modal").empty(),$("#conectividad_modal").append(new Option("Seleccionar","default"))),$("#conectividad_modal").selectpicker("refresh")})}),$("#alta_proyecto").on("click",".papelera",function(){$("#deleteProject").attr("name",$(this).attr("name"))}),$("#deleteProject").on("click",function(){var id=$(this).attr("name"),formURL="/projectServlet?",postData="accion=delete&id="+id;$.ajax({url:formURL,type:"POST",data:postData,success:function(){$("#row"+id).fadeOut("fast",function(){$(this).remove(),$("#myTable").paginateMe({pagerSelector:"#myPager",showPrevNext:!0,hidePageNumbers:!1,perPage:5})}),$("#confirm-delete").modal("hide")}})}),$("#submit_project_form").on("click",function(e){e.preventDefault();var $form=$("#new-project-form");if($form.valid()){var postData=$form.serialize()+"&accion=new",formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success?($("#message_div").removeClass("error").addClass("success"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$form.find(".form-container").find("div:not(#message_div)").hide(0),$("#span_message").html("El proyecto se ha creado de forma correcta."),$("#message_div").css("display","block"),$("#buttons_holder").css("display","none"),resetForm($form),setTimeout(function(){$("#message_div").fadeOut("slow",function(){$("#span_message").html("")}),location.reload()},3e3)):($("#message_div").removeClass("success").addClass("error"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message").html(data.error),$("#message_div").css("display","block"))},error:function(jqXHR,textStatus,errorThrown){errorThrown.length>0&&($("#span_message").html(errorThrown),$("#message_div").addClass("error").removeClass("success"))}})}})});var normalize=function(){for(var from="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç",to="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc",mapping={},i=0,j=from.length;j>i;i++)mapping[from.charAt(i)]=to.charAt(i);return function(str){for(var ret=[],i=0,j=str.length;j>i;i++){var c=str.charAt(i);ret.push(mapping.hasOwnProperty(str.charAt(i))?mapping[c]:c)}return ret.join("")}}();$(function(){$(".search").on("keyup",function(e){var $table=$(this).closest("table").find("tbody").first(),$table_results=$table.children(),$current_input=$(this);$(this).closest("tr").find(".search-th").find("input").each(function(){$(this).is($current_input)||0==$(this).val().length||(multipleFilter=!0)});for(var e=0;e<$table_results.length;e++){var isValid=!0,$linea=$($table_results[e]);$(this).closest("tr").find(".search-th").find("input").each(function(){if(0!=$(this).val().length){var text=normalize($(this).val().toLowerCase()),columna=$(this).attr("class").split("col")[1];$(this).hasClass("search_anywhere")&&(columna=columna.split(" ")[0]);var cont=$($linea.children()[columna]).children().html().toLowerCase(),textLength=text.length;$(this).hasClass("search_anywhere")?-1==cont.indexOf(text)&&(isValid=!1):text!=cont.substring(0,textLength)&&(isValid=!1)}}),isValid?$linea.show().addClass("valid-result"):$linea.hide().removeClass("valid-result")}$table.paginateMe({pagerSelector:"#myPager",showPrevNext:!0,hidePageNumbers:!1,perPage:5})})}),$(function(){$("#sidebar").hover(function(){$(this).addClass("hovering")},function(){$(this).removeClass("hovering")})});var cnombre="",cap1="",cap2="",cemail="",cpermiso="",areas,dto,id;$(function(){$("#myTable").paginateMe({pagerSelector:"#myPager",showPrevNext:!0,hidePageNumbers:!1,perPage:5}),$(".alta_usuario").on("loaded.bs.modal",function(){editRow(id)}),$(".selectpicker").selectpicker();var userBoxSize=0;$("#newUserButton").click(function(){var $newUserButton=$(this);$newUserButton.hasClass("white-btn")?"visible"==$(".new-user-form-holder").css("overflow")&&($(".new-user-form-holder").css("overflow","hidden"),userBoxSize=$(".new-user-form-holder.open").outerHeight(),$(".new-user-form-holder.open").css("height",userBoxSize),setTimeout(function(){$(".new-user-form-holder.open").removeClass("open").css("height","0px")},25),setTimeout(function(){$("#newUserButton").removeClass("white-btn"),$($("#newUserButton").children()[0]).removeClass("blue");var $form=$newUserButton.parent().find("form");resetForm($form)},1e3)):"hidden"==$(".new-user-form-holder").css("overflow")&&($("#newUserButton").addClass("white-btn"),$($("#newUserButton").children()[0]).addClass("blue"),$(".new-user-form-holder").addClass("open"),userBoxSize>0&&setTimeout(function(){$(".new-user-form-holder").css("height",userBoxSize)},25),setTimeout(function(){$(".new-user-form-holder.open").css("height","auto")},1e3),setTimeout(function(){$(".new-user-form-holder").css("overflow","visible")},1e3))}),$("#confirm-delete").on("show.bs.modal",function(e){$(this).find(".danger").attr("href",$(e.relatedTarget).data("href"))}),$(".alta_usuario").on("click",".papelera",function(){$("#deleteUser").attr("name",$(this).attr("name"))}),$(".gestion_cliente").on("click",".papelera",function(){$("#deleteClient").attr("name",$(this).attr("name"))}),$("#deleteClient").on("click",function(){var id=$(this).attr("name"),formURL="/clienteServlet?",postData="accion=delete&id="+id;$.ajax({url:formURL,type:"POST",data:postData,success:function(){$("#row"+id).fadeOut("fast",function(){$(this).remove(),$("#myTable").paginateMe({pagerSelector:"#myPager",showPrevNext:!0,hidePageNumbers:!1,perPage:5})}),$("#confirm-delete").modal("hide")}})}),$("#submit_edit_user_form").on("click",function(){var $form=$("#edit-user-form");if($form.valid()){var areas="",$checkedBoxes=$form.find(".radio-container-holder").find(".radio-container").find("input:checked");$checkedBoxes.each(function(i){areas+=$(this).val(),i<$checkedBoxes.length-1&&(areas+="_")});var postData=$form.serialize()+"&accion=update&areasStr="+areas,formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success?($(".edit-user-form-holder").height()<190&&$(".edit-user-form-holder").height($(".edit-user-form-holder").height()+35),$form.find(".form-container").find("div:not(#message_div_modal)").hide(0),$form.find("#span_message_modal").html("El usuario ha sido creado de forma correcta.<br/>En breve volvemos a la p&aacute;gina."),$("#modal-footer_submit").css("display","none"),$("#message_div_modal").css("display","block").removeClass("error").addClass("success"),setTimeout(function(){resetForm($form),location.reload()},1500)):($("#message_div_modal").removeClass("success").addClass("error"),$(".edit-user-form-holder").height()<190&&$(".edit-user-form-holder").height($(".edit-user-form-holder").height()+35),$("#span_message_modal").html(data.error),$("#message_div_modal").css("display","block"))}},"html")}}),$("#deleteUser").on("click",function(){var id=$(this).attr("name"),formURL="/usersServlet?",postData="accion=delete&id="+id;$.ajax({url:formURL,type:"POST",data:postData,success:function(){$("#row"+id).fadeOut("fast",function(){$(this).remove(),$("#myTable").paginateMe({pagerSelector:"#myPager",showPrevNext:!0,hidePageNumbers:!1,perPage:5})}),$("#confirm-delete").modal("hide")}})}),$(".alta_usuario").on("click",".lapiz",function(){id=$(this).attr("name"),$(this).hasClass("inactive")||editRow(id)}),$("#submit_user_form").on("click",function(e){e.preventDefault();var $form=$("#new-user-form");if($form.valid()){var areas="",$checkedBoxes=$form.find(".radio-container-holder").find(".radio-container").find("input:checked");$checkedBoxes.each(function(i){areas+=$(this).val(),i<$checkedBoxes.length-1&&(areas+="_")});var postData=$form.serialize()+"&accion=new&areasStr="+areas,formURL=$form.attr("action");$.ajax({url:formURL,type:"GET",data:postData,success:function(data){"true"==data.success?($(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$form.find(".form-container").find("div:not(#message_div)").hide(0),$form.find("#span_message").html("El usuario ha sido creado de forma correcta.<br/>En breve volvemos a la p&aacute;gina."),$("#message_div").css("display","block").removeClass("error").addClass("success"),setTimeout(function(){resetForm($form),location.reload()},1500)):($("#message_div").removeClass("success").addClass("error"),$(".new-user-form-holder").height()<190&&$(".new-user-form-holder").height($(".new-user-form-holder").height()+35),$("#span_message").html(data.error),$("#message_div").css("display","block"))},error:function(jqXHR,textStatus,errorThrown){errorThrown.length>0&&($("#span_message").html(errorThrown),$("#message_div").addClass("error").removeClass("success"))}})}return!1})}),$(function(){$.extend($.validator.messages,{required:"Este campo es obligatorio.",remote:"Por favor, rellena este campo.",email:"Por favor, escribe una direcci&oacuten de correo v&aacutelida.(Terminada en @bbva.com)",url:"Por favor, escribe una URL válida.",date:"Por favor, escribe una fecha válida.",dateISO:"Por favor, escribe una fecha (ISO) válida.",number:"Por favor, escribe un n&uacutemero v&aacutelido.",digits:"Por favor, escribe s&oacutelo dígitos.",creditcard:"Por favor, escribe un número de tarjeta válido.",equalTo:"Por favor, escribe el mismo valor de nuevo.",extension:"Por favor, escribe un valor con una extensión aceptada.",maxlength:$.validator.format("Por favor, no escribas más de {0} caracteres."),minlength:$.validator.format("Por favor, no escribas menos de {0} caracteres."),rangelength:$.validator.format("Por favor, escribe un valor entre {0} y {1} caracteres."),range:$.validator.format("Por favor, escribe un valor entre {0} y {1}."),max:$.validator.format("Por favor, escribe un valor menor o igual a {0}."),min:$.validator.format("Por favor, escribe un valor mayor o igual a {0}."),nifES:"Por favor, escribe un NIF válido.",nieES:"Por favor, escribe un NIE válido.",cifES:"Por favor, escribe un CIF válido."}),$.validator.addMethod("money",function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:[\s\.,]\d{3})+)(?:[\.,]\d+)?$/.test(value)},"Por favor, introduce una cifra v&aacute;lida"),$.validator.addMethod("selected",function(value,element){var valid=!1;return"default"!=value?(valid=!0,$(element).parent().find(".bootstrap-select").removeClass("error")):$(element).parent().find(".bootstrap-select").addClass("error"),valid},"Por favor, selecciona un valor."),$.validator.addMethod("require-one",function(value,element){var valid=!1,selector="input[name="+$(element).attr("name")+"]";$(element).closest("form").find(selector).each(function(){$(this).is(":checked")&&(valid=!0)});var modal=-1!=$(element).attr("id").indexOf("modal");return 0==valid?modal?($("#message_div_cliente_modal").addClass("error"),$("#span_message_cliente_modal").text("Debe seleccionar un país")):($("#message_div_cliente").addClass("error"),$("#span_message_cliente").text("Debe seleccionar un país")):modal?($("#message_div_cliente_modal").removeClass("error"),$("#span_message_cliente_modal").text("")):($("#message_div_cliente").removeClass("error"),$("#span_message_cliente").text("")),valid},"Por favor, selecciona una opci&oacute;n."),initValidator()});var initValidator=function(){$("form").each(function(){$(this).validate({ignore:":hidden:not(select):not([type='radio']):not([type='checkbox'])",focusCleanup:!1,onkeyup:!1,submitHandler:function(form){form.submit()},errorPlacement:function(error,$element){var $target=$element.parent();$target.find(".error-messages").remove();var $container="";if($element.hasClass("selectpicker")&&($element=$target.find(".bootstrap-select")),($element.is(":checkbox")||$element.is(":radio"))&&$element.parent().hasClass("radio-container")){var $target=$element.closest(".radio-container-holder"),$container=$target.find("#error-messages");0==$container.length&&($container=$('<div id="error-messages" class="block-error server-errors"><ul></ul></div>'),$element.closest(".radio-container-holder").prepend($container));var $errorelement=$("<li>");$errorelement.append(error),$container.find("ul").append($errorelement)}else $container=$('<div class="error-messages"><ul></ul></div>'),$target.css({position:"relative"}).prepend($container);if(!$element.hasClass("no_message_error")){var $errorelement=$("<li>");$errorelement.append(error),$container.find("ul").append($errorelement);var leftPosition=0;$element.outerWidth()<$container.outerWidth()?leftPosition=($element.outerWidth()-$container.outerWidth())/2:$element.outerWidth()>$container.outerWidth()&&(leftPosition=($element.outerWidth()-$container.outerWidth())/2),$container.css({left:$element.position().left+leftPosition+"px",marginLeft:$element.css("margin-left"),maxWidth:"200px"}),$container.css({top:"-"+($container.outerHeight()+10)+"px"}),$element.hover(function(){$container.addClass("hover")},function(){$container.removeClass("hover")})}},success:function(label){label.closest(".error-messages").remove()}})})};